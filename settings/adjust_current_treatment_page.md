# Страница корректировки текущего лечения

## 1. Назначение экрана
Позволяет пользователю изменить параметры текущего активного лечения: количество дней ношения для каждого элайнера и настройки плана лечения.

## 2. Основные компоненты экрана

### Заголовок страницы
- **Кнопка закрытия**: Кнопка для возврата к предыдущему экрану
- **Заголовок**: Название страницы "Корректировка лечения"
- **Кнопка изменения настроек**: Кнопка в верхней правой части экрана для открытия меню настроек лечения

### План лечения
- **Список этапов**: Отображение всех этапов лечения с датами
- **Карточки элайнеров**: Информация о каждом элайнере с возможностью редактирования
- **Визуальные связи**: Элементы, показывающие связь между этапами
- **Компонент прогресса этапов**: Для реализации можно использовать готовые пакеты:
  - [step_progress](https://pub.dev/packages/step_progress) - поддерживает вертикальную и горизонтальную ориентацию, кастомизацию узлов и линий
  - [flutter_steps](https://pub.dev/packages/flutter_steps/versions/1.0.4) - альтернативный пакет для создания индикаторов прогресса этапов

### Карточки элайнеров
- **Активная карточка**: Выделенная карточка текущего элайнера
- **Неактивные карточки**: Карточки остальных элайнеров
- **Информация об элайнере**: Номер и количество дней ношения
- **Кнопка редактирования**: Кнопка для изменения параметров элайнера

### Окно редактирования
- **Заголовок**: Название редактируемого параметра
- **Список опций**: Варианты значений для выбора
- **Текущее значение**: Выбранная опция
- **Дополнительные настройки**: Опции для применения изменений к другим элементам
- **Кнопки действий**: Кнопки отмены и подтверждения

### Меню настроек лечения
- **Боттомшит**: Окно, появляющееся снизу экрана при нажатии на кнопку изменения настроек
- **Пункт "Изменить дату начала лечения"**: Опция для открытия диалога изменения даты начала лечения
- **Пункт "Изменить количество элайнеров"**: Опция для открытия диалога изменения количества элайнеров
- **Пункт "Редактировать информацию по элайнеру"**: Опция для открытия диалога редактирования информации по элайнеру

### Диалог изменения даты начала лечения
- **Заголовок**: Название диалога
- **Компонент выбора даты**: Элемент для выбора новой даты начала лечения (барабан)
- **Текущая дата**: Отображение текущей даты начала лечения
- **Кнопки действий**: Кнопки отмены и подтверждения

### Диалог изменения количества элайнеров
- **Заголовок**: Название диалога
- **Компонент выбора количества**: Элемент для ввода или выбора нового количества элайнеров
- **Текущее количество**: Отображение текущего количества элайнеров
- **Кнопки действий**: Кнопки отмены и подтверждения

### Диалог редактирования информации по элайнеру
- **Заголовок**: Название диалога с указанием номера элайнера
- **Список значений количества дней**: Прокручиваемый список вариантов количества дней для ношения элайнера
- **Текущее значение**: Выделенное значение количества дней, установленное для элайнера
- **Опция применения к последующим элайнерам**: Чекбокс для применения изменений к последующим элайнерам в группе
- **Кнопки действий**: Кнопки отмены и подтверждения

## 3. Пользовательские сценарии

### Основной сценарий редактирования
1. Пользователь открывает страницу корректировки лечения
2. Пользователь просматривает план лечения
3. Пользователь нажимает на кнопку редактирования нужного элайнера
4. Открывается окно редактирования параметров
5. Пользователь выбирает новое значение из списка опций
6. Пользователь при необходимости настраивает дополнительные параметры
7. Пользователь подтверждает изменения
8. Окно редактирования закрывается, изменения отображаются в карточке элайнера
9. Пользователь нажимает кнопку подтверждения для сохранения всех изменений

### Сценарий отмены изменений
1. Пользователь открывает окно редактирования параметров
2. Пользователь вносит изменения в настройки
3. Пользователь нажимает кнопку отмены
4. Окно редактирования закрывается без применения изменений

### Сценарий применения изменений к другим элементам
1. Пользователь редактирует параметры элайнера
2. Пользователь активирует опцию применения к другим элементам
3. Пользователь подтверждает изменения
4. Система автоматически обновляет соответствующие параметры

### Сценарий закрытия без сохранения
1. Пользователь вносит изменения в параметры
2. Пользователь нажимает кнопку закрытия
3. Система возвращает пользователя к предыдущему экрану без сохранения изменений

### Сценарий изменения даты начала лечения
1. Пользователь нажимает кнопку изменения настроек в заголовке страницы
2. Открывается боттомшит с пунктами меню
3. Пользователь выбирает пункт "Изменить дату начала лечения"
4. Боттомшит закрывается, открывается диалог изменения даты начала лечения
5. Пользователь выбирает новую дату начала лечения
6. Пользователь подтверждает изменения
7. Диалог закрывается, план лечения обновляется с новой датой начала

### Сценарий изменения количества элайнеров
1. Пользователь нажимает кнопку изменения настроек в заголовке страницы
2. Открывается боттомшит с пунктами меню
3. Пользователь выбирает пункт "Изменить количество элайнеров"
4. Боттомшит закрывается, открывается диалог изменения количества элайнеров
5. Пользователь вводит или выбирает новое количество элайнеров
6. Пользователь подтверждает изменения
7. Диалог закрывается, план лечения обновляется с новым количеством элайнеров

### Сценарий закрытия боттомшита
1. Пользователь открывает боттомшит через кнопку изменения настроек
2. Пользователь нажимает вне области боттомшита или использует жест закрытия
3. Боттомшит закрывается без открытия диалогов

### Сценарий редактирования информации по элайнеру
1. Пользователь нажимает кнопку изменения настроек в заголовке страницы
2. Открывается боттомшит с пунктами меню
3. Пользователь выбирает пункт "Редактировать информацию по элайнеру"
4. Боттомшит закрывается, открывается диалог редактирования информации по элайнеру
5. В диалоге отображается количество дней для ношения группы элайнеров
6. Пользователь просматривает список доступных значений количества дней
7. Пользователь выбирает новое значение количества дней из списка
8. Пользователь при необходимости активирует опцию применения изменений к последующим элайнерам
9. Пользователь подтверждает изменения
10. Диалог закрывается, план лечения обновляется с новым количеством дней для элайнера

## 4. Состояния экрана

### Состояние загрузки
- Индикатор загрузки при открытии страницы и загрузке данных о плане лечения

### Состояние отображения плана лечения
- Отображение всех этапов лечения
- Выделение активного элайнера
- Информация о параметрах каждого элайнера
- Доступность кнопок редактирования

### Состояние открытого окна редактирования
- Окно редактирования поверх основного экрана
- Список опций для выбора
- Выбранная опция с текущим значением
- Доступность дополнительных настроек
- Кнопки отмены и подтверждения

### Состояние ошибки
- Уведомления о проблемах с сохранением данных
- Сообщения об ошибках валидации при некорректных значениях

### Состояние успешного сохранения
- Подтверждение успешного применения изменений
- Автоматический возврат к предыдущему экрану
- Обновление плана лечения с новыми значениями

### Состояние редактирования
- Визуальное выделение измененных элементов
- Активные кнопки редактирования
- Доступность кнопки подтверждения в заголовке

### Состояние открытого боттомшита
- Боттомшит отображается поверх основного экрана
- Доступны три пункта меню для выбора
- Возможность закрытия боттомшита без выбора пункта

### Состояние открытого диалога изменения даты начала лечения
- Диалог отображается поверх основного экрана
- Компонент выбора даты доступен для взаимодействия
- Отображение текущей даты начала лечения
- Кнопки отмены и подтверждения доступны

### Состояние открытого диалога изменения количества элайнеров
- Диалог отображается поверх основного экрана
- Компонент выбора количества доступен для взаимодействия
- Отображение текущего количества элайнеров
- Кнопки отмены и подтверждения доступны

### Состояние открытого диалога редактирования информации по элайнеру
- Диалог отображается поверх основного экрана
- Отображение количества дней для ношения группы элайнеров
- Список значений количества дней доступен для прокрутки и выбора
- Текущее значение количества дней выделено
- Опция применения к последующим элайнерам доступна для активации
- Кнопки отмены и подтверждения доступны
